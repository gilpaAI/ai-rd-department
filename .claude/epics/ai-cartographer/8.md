---
name: Refresh command — incremental updates
status: open
created: 2026-02-17T16:35:56Z
updated: 2026-02-17T18:36:12Z
github: https://github.com/gilpaAI/ai-cartographer/issues/8
depends_on: [7]
parallel: true
conflicts_with: []
---

# Task: Refresh command — incremental updates

## Description
Build the `refresh` command that incrementally updates the context map by only re-analyzing files whose content has changed since the last generation. Uses content-hash cache for change detection.

## Acceptance Criteria
- [ ] `ai-cartographer refresh` updates the map incrementally
- [ ] Compares current file hashes against cached hashes in .ai/.cache/hashes.json
- [ ] Only sends changed/new files to LLM for re-analysis
- [ ] Removes deleted files from the map
- [ ] Preserves cached descriptions for unchanged files
- [ ] Updates the hash cache after successful refresh
- [ ] Completes in <5s for typical commits (1-20 changed files)
- [ ] Shows summary: "Refreshed: 5 files updated, 2 added, 1 removed (450 unchanged)"
- [ ] Handles missing cache gracefully (falls back to full init)

## Technical Details
- Load existing cache from .ai/.cache/hashes.json
- Discover current files, compute hashes
- Diff: added = new paths, changed = same path different hash, removed = cached path not found
- Re-analyze only added + changed files
- Merge new descriptions with cached descriptions
- Regenerate map from merged descriptions

## Dependencies
- [ ] Task 7 (init command establishes the pipeline and cache)

## Effort Estimate
- Size: S
- Hours: 5
- Parallel: true (can develop alongside 9)

## Definition of Done
- [ ] Code implemented in src/commands/refresh.ts
- [ ] Incremental update tested (change 1 file, verify only it re-analyzed)
- [ ] Performance under 5s for small changes
- [ ] Missing cache triggers full re-scan
