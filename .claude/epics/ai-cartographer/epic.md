---
name: ai-cartographer
status: backlog
created: 2026-02-17T16:31:16Z
progress: 0%
prd: .claude/prds/ai-cartographer.md
repo: gilpaAI/ai-cartographer
github: https://github.com/gilpaAI/ai-cartographer/issues/1
---

# Epic: ai-cartographer

## Overview

An open-source CLI tool that generates AI-optimized semantic context maps for codebases. Uses an LLM-first approach — all file descriptions are generated by AI, with aggressive cost optimizations (content-hash caching, batched analysis, tiered file classification, model routing). Ships as an npm package installable via `npx ai-cartographer init`.

## Architecture Decisions

- **Runtime: Node.js (TypeScript)** — Best install experience for target audience (developers using npm-based AI tools). `npx` support out of the box. Largest ecosystem for CLI tooling (commander, inquirer, cosmiconfig).
- **LLM-first, no custom parsers** — All semantic descriptions generated by LLM API. Eliminates need for language-specific AST parsers. Dramatically reduces codebase complexity.
- **Tiered file classification** — Files categorized into auto-skip / batch / deep tiers to minimize API costs. Pattern-based rules determine tier assignment.
- **Model routing** — Cheap model (Haiku) for batch tier, capable model (Sonnet) for deep tier. Configurable per-tier.
- **Content-hash caching** — SHA-256 hash per file stored in `.ai/.cache/hashes.json`. Only re-analyze files whose content changed. Cache is gitignored.
- **Output format: Markdown** — `.ai/context-map.md` as primary output. Human-readable, LLM-optimized. Hierarchical directory grouping with rollup summaries.
- **Config format: JSON** — `.ai/cartographer.config.json` using cosmiconfig for flexible loading.

## Technical Approach

### CLI Layer
- Built with `commander` for command parsing
- Commands: `init`, `refresh`, `status`, `config`, `hooks install`
- Global flags: `--verbose`, `--free`, `--dry-run`, `--output`, `--format`
- Interactive config via `inquirer` prompts

### Core Engine
- **File Discovery**: Walk directory tree respecting ignore rules (uses `.gitignore` + custom ignores). Collect file paths and metadata.
- **Tier Classifier**: Pattern matcher that assigns each file to auto-skip / batch / deep tier based on filename patterns, extensions, and directory conventions.
- **Content Hasher**: SHA-256 hash of each file. Compare against cached hashes to determine changed files.
- **LLM Client**: Abstraction over Claude/OpenAI APIs. Handles batching (10-20 files per call), rate limiting, retries, and model routing per tier.
- **Map Generator**: Takes file descriptions and produces hierarchical markdown output with directory grouping and section headers.

### LLM Integration
- Provider abstraction: `AnthropicProvider` and `OpenAIProvider` implementing common interface
- Batch prompt template: sends file paths + content snippets, receives structured one-line descriptions
- Deep prompt template: sends full file content, receives rich description
- Configurable: provider, model per tier, max concurrent requests

### Auto-Maintenance
- Git hook installer: writes post-commit hook that runs `ai-cartographer refresh`
- Incremental refresh: only re-analyzes files with changed content hashes
- Staleness detection: compare last generation commit SHA against HEAD

### Infrastructure
- Published to npm as `ai-cartographer`
- No external infrastructure needed — runs entirely locally
- CI: GitHub Actions for tests, linting, npm publish

## Implementation Strategy

### Phase 1: Foundation (Tasks 1-3)
Project scaffolding, file discovery, tier classification, and content hashing. No LLM calls yet — just the infrastructure.

### Phase 2: Core Engine (Tasks 4-6)
LLM client with batching and model routing, map generation with hierarchical output, and the `init` command wiring it all together.

### Phase 3: Maintenance & Polish (Tasks 7-9)
Incremental refresh, git hooks, `status` command, `--free` mode, `--dry-run`, and npm packaging.

## Task Breakdown Preview

- [ ] Task 1: Project scaffolding — TypeScript, commander CLI, config loading
- [ ] Task 2: File discovery and ignore rules — directory walker with .gitignore + custom ignores
- [ ] Task 3: Tier classifier and content hasher — pattern matching + SHA-256 caching
- [ ] Task 4: LLM client with batching — provider abstraction, batch/deep prompts, rate limiting
- [ ] Task 5: Map generator — hierarchical markdown output with directory grouping
- [ ] Task 6: `init` command — wire discovery → classify → analyze → generate pipeline
- [ ] Task 7: `refresh` command — incremental updates using content-hash diff
- [ ] Task 8: Git hooks and `status` command — auto-maintenance and staleness detection
- [ ] Task 9: Free mode, dry-run, and npm packaging — `--free` flag, cost estimation, publish config

## Dependencies

- **External services**: Claude API or OpenAI API (user provides key)
- **npm packages**: commander, cosmiconfig, inquirer, crypto (built-in), glob/fast-glob, chalk
- **No internal dependencies** — standalone project

## Success Criteria (Technical)

- `npx ai-cartographer init` produces a context map in <60s for a 500-file repo
- Incremental refresh completes in <5s for typical commits
- Context map for 500 files fits under 4,000 tokens
- Batch tier uses ~90% fewer API calls than one-per-file
- Content-hash cache prevents re-analysis of unchanged files
- `--free` mode works without any API key
- `--dry-run` shows accurate file count, tier breakdown, and cost estimate

## Estimated Effort

- **Overall**: Medium-Large (9 tasks, ~12-16 days)
- **Phase 1 (Foundation)**: 3-4 days
- **Phase 2 (Core Engine)**: 5-6 days
- **Phase 3 (Polish)**: 4-6 days
- **Critical path**: Tasks 1 → 4 → 6 (scaffolding → LLM client → init command)

## Tasks Created
- [ ] #2 - Project scaffolding — TypeScript CLI with config loading (parallel: false)
- [ ] #3 - File discovery and ignore rules (parallel: true)
- [ ] #4 - Tier classifier and content hasher (parallel: true)
- [ ] #5 - LLM client with provider abstraction and batching (parallel: true)
- [ ] #6 - Map generator — hierarchical markdown output (parallel: true)
- [ ] #7 - Init command — wire the full pipeline (parallel: false)
- [ ] #8 - Refresh command — incremental updates (parallel: true)
- [ ] #9 - Git hooks and status command (parallel: true)
- [ ] #10 - Free mode, dry-run, and npm packaging (parallel: true)

Total tasks: 9
Parallel tasks: 7
Sequential tasks: 2
Estimated total effort: 56 hours
