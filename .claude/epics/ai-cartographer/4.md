---
name: Tier classifier and content hasher
status: open
created: 2026-02-17T16:35:56Z
updated: 2026-02-17T18:36:09Z
github: https://github.com/gilpaAI/ai-cartographer/issues/4
depends_on: [2]
parallel: true
conflicts_with: []
---

# Task: Tier classifier and content hasher

## Description
Build the tier classifier that assigns each discovered file to auto-skip / batch / deep tier, and the content hasher that generates SHA-256 hashes for change detection and caching.

## Acceptance Criteria
- [ ] Tier classifier assigns files to: auto-skip, batch, or deep
- [ ] Auto-skip patterns: lockfiles, *.min.js, *.d.ts, *.map, .eslintrc, tsconfig.json, LICENSE, CHANGELOG, generated files
- [ ] Deep tier: files matching "key entry points" from config
- [ ] Batch tier: everything else (default)
- [ ] Auto-skip files get pattern-based descriptions without API calls (e.g., "Dependency lockfile", "TypeScript declarations", "ESLint configuration")
- [ ] Content hasher generates SHA-256 for each file
- [ ] Hash cache stored in .ai/.cache/hashes.json
- [ ] Cache comparison: returns lists of added/changed/removed files
- [ ] --dry-run uses tier counts + batch sizes to estimate API cost

## Technical Details
- Tier rules: configurable pattern lists per tier in config
- Default auto-skip descriptions: Map<pattern, description> lookup
- SHA-256 via Node crypto module (built-in)
- Cache format: { "path": { hash, tier, description?, lastAnalyzed } }
- Cost estimation: (batchFiles / batchSize) * batchCostPerCall + deepFiles * deepCostPerCall

## Dependencies
- [ ] Task 2 (config structure for tier patterns and key entry points)

## Effort Estimate
- Size: S
- Hours: 5
- Parallel: true (can develop alongside 3 once 2 is done)

## Definition of Done
- [ ] Code implemented in src/classifier.ts and src/hasher.ts
- [ ] Tier classification tests with various file types
- [ ] Hash caching works correctly (save/load/compare)
- [ ] Dry-run cost estimation produces reasonable numbers
