---
name: Init command — wire the full pipeline
status: open
created: 2026-02-17T16:35:56Z
updated: 2026-02-17T18:36:11Z
github: https://github.com/gilpaAI/ai-cartographer/issues/7
depends_on: [3, 4, 5, 6]
parallel: false
conflicts_with: []
---

# Task: Init command — wire the full pipeline

## Description
Wire the `init` command that orchestrates the full pipeline: discover files → classify tiers → analyze via LLM → generate map. This is the primary user-facing command that produces the context map from scratch.

## Acceptance Criteria
- [ ] `npx ai-cartographer init` runs the full pipeline end-to-end
- [ ] Pipeline: discover → classify → hash → analyze (batch + deep) → generate
- [ ] Progress display: shows current step, file count, estimated time/cost
- [ ] Creates .ai/ directory and .ai/.cache/ if they don't exist
- [ ] Adds .ai/.cache/ to .gitignore (but NOT .ai/context-map.md)
- [ ] Saves content hashes to cache after successful generation
- [ ] Handles --dry-run: shows file counts, tier breakdown, cost estimate, then exits
- [ ] Handles --free: skips LLM, uses auto-skip descriptions + filename-pattern descriptions for all files
- [ ] Handles --verbose: shows per-file analysis progress
- [ ] Error handling: if LLM fails mid-scan, saves partial results and reports which files are pending
- [ ] Completes in <60s for a 500-file repo

## Technical Details
- Orchestrator in src/commands/init.ts
- Pipeline steps are composable functions
- Progress display using ora or simple console output
- .gitignore manipulation: append .ai/.cache/ if not already present
- Partial save: write map with available descriptions, mark pending files

## Dependencies
- [ ] Task 3 (file discovery)
- [ ] Task 4 (tier classifier and hasher)
- [ ] Task 5 (LLM client)
- [ ] Task 6 (map generator)

## Effort Estimate
- Size: M
- Hours: 8
- Parallel: false (depends on all core components)

## Definition of Done
- [ ] Code implemented in src/commands/init.ts
- [ ] End-to-end test on a real repository
- [ ] --dry-run shows accurate estimates
- [ ] --free mode produces useful output without API key
- [ ] Performance within 60s for 500-file repo
