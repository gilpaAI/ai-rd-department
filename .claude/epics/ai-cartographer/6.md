---
name: Map generator — hierarchical markdown output
status: open
created: 2026-02-17T16:35:56Z
updated: 2026-02-17T18:36:11Z
github: https://github.com/gilpaAI/ai-cartographer/issues/6
depends_on: [2]
parallel: true
conflicts_with: []
---

# Task: Map generator — hierarchical markdown output

## Description
Build the map generator that takes file descriptions and produces the final .ai/context-map.md output. Groups files hierarchically by directory with rollup summaries, adds section headers, and includes metadata.

## Acceptance Criteria
- [ ] Groups files by directory hierarchy
- [ ] Directory rollup summaries (e.g., "src/auth/ — Authentication and authorization modules")
- [ ] Semantic section headers based on directory purpose (e.g., "## Core Business Logic", "## Tests", "## Configuration")
- [ ] No redundant directory path repetition (files listed relative to their section)
- [ ] Metadata header: generation timestamp, repo name, total files, tool version
- [ ] Token-efficient: 500-file project output fits under 4,000 tokens
- [ ] Output is deterministic (same input → same output)
- [ ] Configurable output path (default: .ai/context-map.md)

## Technical Details
- Input: FileDescription[] with { path, description, tier }
- Build directory tree structure, then flatten to markdown
- Section detection: heuristic based on common directory names (src, lib, test, docs, config, scripts)
- Compression: use relative paths within sections, single-line descriptions
- Token counting: rough estimate (1 token ≈ 4 chars) to validate output size
- Write to configured output path, creating .ai/ directory if needed

## Dependencies
- [ ] Task 2 (config for output path)

## Effort Estimate
- Size: M
- Hours: 6
- Parallel: true (can develop alongside other tasks)

## Definition of Done
- [ ] Code implemented in src/generator.ts
- [ ] Output tested against token budget (4K tokens for 500 files)
- [ ] Hierarchical grouping produces clean, readable output
- [ ] Deterministic output verified
